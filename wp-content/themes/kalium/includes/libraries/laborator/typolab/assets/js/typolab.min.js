!function(){"use strict";function t(){return typolab_settings.previewText||"Almost before we knew it, we had left the ground."}function e(t){return t.replace(/\s+/g,"+")}function n(t){t=_.defaults(t,{family:"",variants:[],display:"swap",text:null});let n=400,i=!1,s=[],a=[],o=t=>1===s.length&&n===s[0]?a.length>1||1===a.length&&n!==a[0]?[1,t].join(","):1:[1,t].join(","),r=t=>s.length&&a.length?1===a.length&&n===a[0]?0:[0,t].join(","):t;const l=["family=",e(t.family)];return t.variants.forEach((t=>{t.isRegular()||(i=!0),t.isRegular()?t.isItalic()?s.push(400):a.push(400):t.isItalic()?s.push(t.weight):a.push(t.weight)})),s=_.uniq(s).sort(),a=_.uniq(a).sort(),(a.length>1||s.length>0||1===a.length&&400!==a[0])&&(l.push(":"),s.length>0&&l.push("ital"),(a.length>0&&(a.length>1||400!==a[0])||i)&&(l.push(s.length?",":""),l.push("wght")),l.push("@"),l.push(a.map(r).join(";")),l.push(a.length&&s.length?";":""),l.push(s.map(o).join(";"))),t.display&&(l.push("&"),l.push(`display=${t.display}`)),t.text&&(l.push("&"),l.push(`text=${e(t.text)}`)),l.unshift("https://fonts.googleapis.com/css2?"),l.join("")}function i(t,e){let n=[];t.getAvailableVariants().forEach(((t,i)=>{let s=e.eq(i),a,o=s.find('input[type="checkbox"]').is(":checked");s[o?"addClass":"removeClass"]("is-checked"),o&&n.push(t)})),t.setVariants(n)}function s(t,e){let n="normal"===t.weight?400:+t.weight,i="normal"===e.weight?400:+e.weight;return t.isItalic()&&(n+=1),e.isItalic()&&(i+=1),n-i}function a(t,e){function n(t){var e=t.match(/\n/g);e&&(L+=e.length);var n=t.lastIndexOf("\n");E=~n?t.length-n:E+t.length}function i(){var t={line:L,column:E};return function(e){return e.position=new s(t),d(),e}}function s(t){this.start=t,this.end={line:L,column:E},this.source=e.source}function a(n){var i=new Error(e.source+":"+L+":"+E+": "+n);if(i.reason=n,i.filename=e.source,i.line=L,i.column=E,i.source=t,!e.silent)throw i;A.push(i)}function l(){var t=u();return{type:"stylesheet",stylesheet:{source:e.source,rules:t,parsingErrors:A}}}function c(){return p(/^{\s*/)}function h(){return p(/^}/)}function u(){var e,n=[];for(d(),f(n);t.length&&"}"!=t.charAt(0)&&(e=I()||R());)!1!==e&&(n.push(e),f(n));return n}function p(e){var i=e.exec(t);if(i){var s=i[0];return n(s),t=t.slice(s.length),i}}function d(){p(/^\s*/)}function f(t){var e;for(t=t||[];e=g();)!1!==e&&t.push(e);return t}function g(){var e=i();if("/"==t.charAt(0)&&"*"==t.charAt(1)){for(var s=2;""!=t.charAt(s)&&("*"!=t.charAt(s)||"/"!=t.charAt(s+1));)++s;if(s+=2,""===t.charAt(s-1))return a("End of comment missing");var o=t.slice(2,s-2);return E+=2,n(o),t=t.slice(s),E+=2,e({type:"comment",comment:o})}}function m(){var t=p(/^([^{]+)/);if(t)return o(t[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(t){return t.replace(/,/g,"â€Œ")})).split(/\s*(?![^(]*\)),\s*/).map((function(t){return t.replace(/\u200C/g,",")}))}function v(){var t=i(),e=p(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(e){if(e=o(e[0]),!p(/^:\s*/))return a("property missing ':'");var n=p(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),s=t({type:"declaration",property:e.replace(T,""),value:n?o(n[0]).replace(T,""):""});return p(/^[;\s]*/),s}}function y(){var t=[],e;if(!c())return a("missing '{'");for(f(t);e=v();)!1!==e&&(t.push(e),f(t));return h()?t:a("missing '}'")}function w(){for(var t,e=[],n=i();t=p(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)e.push(t[1]),p(/^,\s*/);if(e.length)return n({type:"keyframe",values:e,declarations:y()})}function _(){var t=i(),e;if(e=p(/^@([-\w]+)?keyframes\s*/)){var n=e[1],e;if(!(e=p(/^([-\w]+)\s*/)))return a("@keyframes missing name");var s=e[1],o;if(!c())return a("@keyframes missing '{'");for(var r=f();o=w();)r.push(o),r=r.concat(f());return h()?t({type:"keyframes",name:s,vendor:n,keyframes:r}):a("@keyframes missing '}'")}}function F(){var t=i(),e=p(/^@supports *([^{]+)/);if(e){var n=o(e[1]);if(!c())return a("@supports missing '{'");var s=f().concat(u());return h()?t({type:"supports",supports:n,rules:s}):a("@supports missing '}'")}}function V(){var t=i(),e;if(p(/^@host\s*/)){if(!c())return a("@host missing '{'");var n=f().concat(u());return h()?t({type:"host",rules:n}):a("@host missing '}'")}}function b(){var t=i(),e=p(/^@media *([^{]+)/);if(e){var n=o(e[1]);if(!c())return a("@media missing '{'");var s=f().concat(u());return h()?t({type:"media",media:n,rules:s}):a("@media missing '}'")}}function S(){var t=i(),e=p(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(e)return t({type:"custom-media",name:o(e[1]),media:o(e[2])})}function k(){var t=i(),e;if(p(/^@page */)){var n=m()||[];if(!c())return a("@page missing '{'");for(var s=f(),o;o=v();)s.push(o),s=s.concat(f());return h()?t({type:"page",selectors:n,declarations:s}):a("@page missing '}'")}}function x(){var t=i(),e=p(/^@([-\w]+)?document *([^{]+)/);if(e){var n=o(e[1]),s=o(e[2]);if(!c())return a("@document missing '{'");var r=f().concat(u());return h()?t({type:"document",document:s,vendor:n,rules:r}):a("@document missing '}'")}}function C(){var t=i(),e;if(p(/^@font-face\s*/)){if(!c())return a("@font-face missing '{'");for(var n=f(),s;s=v();)n.push(s),n=n.concat(f());return h()?t({type:"font-face",declarations:n}):a("@font-face missing '}'")}}function B(t){var e=new RegExp("^@"+t+"\\s*([^;]+);");return function(){var n=i(),s=p(e);if(s){var a={type:t};return a[t]=s[1].trim(),n(a)}}}function I(){if("@"==t[0])return _()||b()||S()||F()||N()||D()||U()||x()||k()||V()||C()}function R(){var t=i(),e=m();return e?(f(),t({type:"rule",selectors:e,declarations:y()})):a("selector missing")}e=e||{};var L=1,E=1;s.prototype.content=t;var A=[],N=B("import"),D=B("charset"),U=B("namespace");return r(l())}function o(t){return t?t.replace(/^\s+|\s+$/g,""):""}function r(t,e){var n=t&&"string"==typeof t.type,i=n?t:e;for(var s in t){var a=t[s];Array.isArray(a)?a.forEach((function(t){r(t,i)})):a&&"object"==typeof a&&r(a,i)}return n&&Object.defineProperty(t,"parent",{configurable:!0,writable:!0,enumerable:!1,value:e||null}),t}var $=jQuery;class l{constructor({name:t="",style:e="normal",weight:n="normal",unicodeRange:i="",display:s="inherit",data:a={},font:o=null}={}){this.name,this.style,this.weight,this.display,this.unicodeRange,this.fontFiles={},this.instanceId="variant-"+l.instanceCounter++,this.data=a,this.font,this.setName(t),this.setStyle(e),this.setWeight(n),this.setDisplay(s),this.setUnicodeRange(i),this.setFont(o)}setName(t){this.name=t}setStyle(t){this.style="italic"===t?t:"normal"}setWeight(t){this.weight=isNaN(+t)?_.contains(["bold","bolder","lighter"],t)?t:"normal":+t,400===this.weight&&(this.weight="normal")}setDisplay(t){this.display=_.contains(["inherit","auto","block","fallback","optional"],t)?t:"swap"}setUnicodeRange(t){this.unicodeRange=this.formatUnicodeRange(t)}setFont(t){this.font=t}getFontFiles(){return this.fontFiles}addFontFile(t,e){t=t.toLowerCase(),_.contains(["woff2","woff","ttf","svg","eot"],t)&&(this.fontFiles[t]=e)}removeFontFile(t){t=t.toLowerCase(),_.contains(["woff2","woff","ttf","svg","eot"],t)&&delete this.fontFiles[t]}getInstanceId(){return this.instanceId}isRegular(){return"normal"===this.weight}isItalic(){return"italic"===this.style}equals(t){const e=["name","style","weight","display","unicodeRange","fontFiles"];if(!t instanceof l)return!1;for(const n of e){let e=this[n],i=t[n];if("object"==typeof e){for(let t in e)if(e[t]!==i[t])return!1}else if(e!==i)return!1}return!0}formatUnicodeRange(t){return t&&0!==t.trim().length?t.split(",").map((t=>"U+"+t.replace("U+","").replace(/\s/g,""))).join(","):""}generateFontFace(t=""){if(!(t=t||this.name))return null;t=t.replace(/\'/g,"\\'");let e=["@font-face {"];e.push(`\tfont-family: '${this.name||t}';`),e.push(`\tfont-style: ${this.style};`),e.push(`\tfont-weight: ${this.weight};`),e.push(`\tfont-display: ${this.display};`);let n=this.getFontFiles(),i={eot:"embedded-opentype",ttf:"truetype"},s=[];for(const t in n)s.push(`url('${n[t]}') format('${i[t]||t}')`);return s.length&&e.push(`\tsrc: ${s.join(", ")};`),this.unicodeRange&&e.push(`\tunicode-range: ${this.unicodeRange};`),e.push("}"),e.join("\n")}getNicename(){if(this.data.niceName)return this.data.niceName;let t=[];return 100===this.weight?t.push("Thin"):200===this.weight?t.push("Extra Light"):300===this.weight?t.push("Light"):400===this.weight||"normal"===this.weight?t.push("Regular"):500===this.weight?t.push("Medium"):600===this.weight?t.push("Semi Bold"):700===this.weight||"bold"===this.weight?t.push("Bold"):800===this.weight?t.push("Extra Bold"):900===this.weight&&t.push("Black"),!this.isRegular()&&this.weight.toString().match(/^[0-9]+$/)&&t.push(this.weight),this.isItalic()&&(this.isRegular()?t=["Italic"]:t.push("italic")),t.join(" ")}toString(t=null){return t?t.getVariantValue(this):this.font?this.font.getVariantValue(this):[this.weight,this.style].join("-")}export(){return{style:this.style,weight:this.weight,unicodeRange:this.unicodeRange,display:this.display,src:this.fontFiles}}}l.instanceCounter=1,l.createFromGoogleFormat=function(t,e){let n=t.match(/(?<weight>[0-9]+)(?<italic>italic)?/),i="normal",s="normal";return"italic"===t&&(s="italic"),n&&(i=parseInt(n.groups.weight,10),n.groups.italic&&(s="italic")),400===i&&(i="normal"),new this({style:s,weight:i,font:e})},l.createFromLaboratorFontFormat=function(t,e){return this.createFromGoogleFormat(t,e)},l.createFromSystemFontFormat=function(t,e){return this.createFromGoogleFormat(t,e)},l.createFromFontSquirrelFontData=function(t,e){let n=t.filename.replace(/\.[a-z]+$/i,""),i=t.style_name.replace(/([a-z])([A-Z])/,"$1 $2"),s;return t.family_name!==t._fontFamily&&(i=`${t.family_name} - ${i}`),new this({name:n,data:_.extend(t,{niceName:i}),font:e})},l.createFromAdobeFormat=function(t,e){let n=t.split(""),i="i"===n[0]?"italic":"normal",s=Number(n[1]);return s*=100,new this({style:i,weight:s,font:e})};class c extends Array{constructor(t){super(),t instanceof Array&&t.forEach((t=>this.push(t)))}}class h{constructor(t){_.each(t,((t,e)=>{this[e]=t})),this.variants=new c,this.ready()}getSource(){return this.source}getFontFamily(){return this.font_family}setFontFamily(t){this.font_family=t}getVariants(){return this.variants}setVariants(t){this.variants=new c,t instanceof l?(t.setFont(this),this.variants.push(t)):t.forEach((t=>{t instanceof l&&(t.setFont(this),this.variants.push(t))})),this.trigger("variants-updated",this.variants)}getVariantValue(t){let e=[];return t.isRegular()?e.push(t.isItalic()?"italic":"regular"):(e.push(t.weight),t.isItalic()&&e.push("italic")),e.join("")}getAvailableVariants(){return this.getVariants()}getDefaultVariant(){let t=this.getAvailableVariants(),e=null;return t.length&&(e=t[0],t.some((t=>!(!t.isRegular()||t.isItalic())&&(e=t,!0)))),e}getVariantsValue(t=!1){let e=this.getVariants().map((t=>t.toString()));return t?e:e.join(",")}ready(){}}h.prototype.source="none",_.extend(h.prototype,Backbone.Events);class u{constructor(t,e,n){this.fontConstructor=h,this.fontsList=t,this.$container=$("#font_variants_select_and_preview"),this.$fontSelector=e,this.font=null,this.data=n,this.ready()}getFontProvider(){return this.fontProvider}getFontsList(){return this.fontsList}getFont(){return this.font}getContainer(){return this.$container}getData(){return this.data}ready(){}selected(){}select(t){this.font=new this.fontConstructor(t)}preview(){}change(){}}u.prototype.fontProvider="none";const p=[{value:"normal",title:"Normal"},{value:"italic",title:"Italic"}],d=[{value:"100",title:"Thin (100)"},{value:"200",title:"Extra Light (200)"},{value:"300",title:"Light (300)"},{value:"normal",title:"Normal (400)"},{value:"500",title:"Medium (500)"},{value:"600",title:"Semi Bold (600)"},{value:"bold",title:"Bold (700)"},{value:"800",title:"Extra Bold (800)"},{value:"900",title:"Black (900)"}],f=[{value:"inherit",title:"Inherit"},{value:"auto",title:"Auto"},{value:"swap",title:"Swap"},{value:"block",title:"Block"},{value:"fallback",title:"Fallback"},{value:"optional",title:"Optional"}],g=typolab_settings.units,m={...g},v={...g},y=typolab_settings.defaultUnit;class w extends h{setVariants(t){"string"==typeof t&&(t=t.split(",")),t instanceof l?super.setVariants(t):super.setVariants(t.map((t=>t instanceof l?t:l.createFromGoogleFormat(t,this))))}getAvailableVariants(){return this.font_data.variants.map((t=>l.createFromGoogleFormat(t,this))).sort(s)}getVariantsPreviewList(){return this.getAvailableVariants().map((t=>({value:t.toString(),title:t.getNicename(),fontFamily:this.getFontFamily(),style:t.style,weight:t.weight})))}getStylesheet(){return n({family:this.getFontFamily()})}getVersion(){return this.font_data.version}getLastModifiedDate(){return this.font_data.lastModified}categoryNicename(){let t=this.category;switch(t){case"display":t="Display";break;case"handwriting":t="Handwriting";break;case"monospace":t="Monospace";break;case"sans-serif":t="Sans Serif";break;case"serif":t="Serif";break}return t}}w.prototype.source="google";class F extends u{ready(){this.fontConstructor=w}selected(){let t=this.getData();t.selected_variants&&t.selected_variants.length&&this.getFont().setVariants(t.selected_variants)}preview(){let s=this.getFont(),a=this.getContainer(),o=wp.template("font-variants-select-container"),r=wp.template("select-font-variants"),l=wp.template("font-details-footer"),c=[],h=n({family:s.getFontFamily(),variants:s.getAvailableVariants(),display:"block",text:t()}),u=[`<a href="https://fonts.google.com/specimen/${e(s.getFontFamily())}" target="_blank" rel="noopener">Font Details</a>`,`Category: ${s.categoryNicename()}`,`Last Update: ${s.getLastModifiedDate()}`];s.getVariants().length||s.setVariants(s.getDefaultVariant()),c.push(r({stylesheet:h,previewText:t(),variants:s.getVariantsPreviewList(),selected:s.getVariantsValue(!0),footer:l({details:u})})),a.html(o({content:c.join("\n")})),a.find('input[type="checkbox"]').on("change",(t=>i(s,a.find(".variant-entry")))),a.find('link[rel="stylesheet"]').on("load",(t=>{a.find(".variant-preview-text").addClass("is-loaded")}))}}F.prototype.fontProvider="google-fonts";class V extends h{ready(){this.fetchedData=[],this.fetched=!1}getVariantValue(t){return t.name}getAvailableVariants(){return this.fetchedData.map((t=>l.createFromFontSquirrelFontData(t,this)))}getDefaultVariant(){let t=this.getAvailableVariants(),e=null;return t.length&&(e=t.shift(),t.some((t=>!!t.name.match(/regular/i)&&(e=t,!0)))),e}getVariantsPreviewList(){return this.getAvailableVariants().map((t=>({value:t.toString(),title:t.getNicename(),image:t.data.listing_image})))}getFamilyUrlName(){return this.font_data.family_urlname}getCategory(){return this.font_data.classification}getFoundryName(){return this.font_data.foundry_name}isFechted(){return this.fetched}fetchFontData(){return fetch(`https://www.fontsquirrel.com/api/familyinfo/${this.getFamilyUrlName()}`).then((t=>t.json())).then((t=>(this.fetchedData=t,this.fetchedData._fontFamily=this.getFontFamily(),this.fetched=!0,new Promise(((e,n)=>{e(t)})))))}}V.prototype.source="font-squirrel";class b extends u{ready(){this.fontConstructor=V}selected(){let t=this.getData();t.selected_variants&&t.selected_variants.length&&(this.selectedVariants=t.selected_variants)}preview(){let t=this.getFont(),n=this.getContainer(),s=wp.template("font-variants-select-container"),a=wp.template("select-font-variants"),o=wp.template("font-details-footer"),r=[];r.push(a({})),n.html(s({content:r.join("\n")})),t.fetchFontData().then((()=>{let l=[`<a href="https://www.fontsquirrel.com/fonts/${e(t.getFamilyUrlName())}/" target="_blank" rel="noopener">Font Details</a>`,`Category: ${t.getCategory()}`,`Author: ${t.getFoundryName()}`];if(this.selectedVariants){let e=t.getAvailableVariants().filter((e=>_.contains(this.selectedVariants,e.toString(t))));t.setVariants(e),this.selectedVariants=null}t.getVariants().length||t.setVariants(t.getDefaultVariant()),r.pop(),r.push(a({variants:t.getVariantsPreviewList(),selected:t.getVariantsValue(!0),footer:o({details:l})})),n.html(s({content:r.join("\n")})),n.find('input[type="checkbox"]').on("change",(e=>i(t,n.find(".variant-entry")))),n.find(".variant-preview-image img").on("load",(t=>{$(t.currentTarget).addClass("is-loaded")}))}))}}b.prototype.fontProvider="font-squirrel";class S extends h{setVariants(t){"string"==typeof t&&(t=t.split(",")),t instanceof l?super.setVariants(t):super.setVariants(t.map((t=>t instanceof l?t:l.createFromLaboratorFontFormat(t,this))))}getAvailableVariants(){return this.font_data.variants.map((t=>l.createFromLaboratorFontFormat(t,this)))}getVariantsPreviewList(){return this.getAvailableVariants().map((t=>({value:t.toString(),title:t.getNicename(),image:this.font_data.images[t.toString()]})))}getFontAuthorUrl(){return this.font_data.url}getPackageSize(){return this.font_data.packageSize}categoryNicename(){return this.font_data.category}}S.prototype.source="laborator";class k extends u{ready(){this.fontConstructor=S}selected(){let t=this.getData();t.selected_variants&&t.selected_variants.length&&this.getFont().setVariants(t.selected_variants)}preview(){let e=this.getFont(),n=this.getContainer(),s=wp.template("font-variants-select-container"),a=wp.template("select-font-variants"),o=wp.template("font-details-footer"),r=[],l=[`<a href="${e.getFontAuthorUrl()}" target="_blank" rel="noopener">Font Details</a>`,`Category: ${e.categoryNicename()}`,`Package Size: ${e.getPackageSize()}`];e.getVariants().length||e.setVariants(e.getDefaultVariant()),r.push(a({previewText:t(),variants:e.getVariantsPreviewList(),selected:e.getVariantsValue(!0),footer:o({details:l})})),n.html(s({content:r.join("\n")})),n.find('input[type="checkbox"]').on("change",(t=>i(e,n.find(".variant-entry")))),n.find(".variant-preview-image img").on("load",(t=>{$(t.currentTarget).addClass("is-loaded")}))}}k.prototype.fontProvider="laborator-fonts";class x extends h{getVariantValue(t){let e=[t.isItalic()?"i":"n",parseInt(+t.weight/100,10)];return isNaN(e[1])&&(e[1]=4),e.join("")}getAvailableVariants(){return this.font_data.variations.map((t=>l.createFromAdobeFormat(t,this)))}getVariantsPreviewList(){return this.getAvailableVariants().map((t=>({value:t.toString(),title:t.getNicename(),fontFamily:this.getFontFamily(),style:t.style,weight:t.weight,disabled:!0})))}getKitID(){return this.font_data.kit_id}getKitName(){return this.font_data.kit_name}getFontSlug(){return this.font_data.slug}getPublishedDate(){return this.font_data.published}}x.prototype.source="adobe";class C extends u{ready(){this.fontConstructor=x,this.$kitId=$('.font-option-field[name="kit_id"]')}preview(){let e=this.getFont(),n=this.getContainer(),i=wp.template("font-variants-select-container"),s=wp.template("select-font-variants"),a=wp.template("font-details-footer"),o=[],r=['<a href="#" title="Reload Adobe Fonts" class="font-refresh-link"><span class="kalium-admin-icon-refresh"></span></a>',`Kit ID: ${e.getKitID()}`,`Kit Name: ${e.getKitName()}`,`Last Modified: ${e.getPublishedDate()}`];e.setVariants(e.getAvailableVariants()),this.$kitId.val(e.getKitID()),o.push(s({stylesheet:`https://use.typekit.net/${e.getKitID()}.css?cachebust=${e.getFontSlug()}`,previewText:t(),variants:e.getVariantsPreviewList(),selected:e.getVariantsValue(!0),footer:a({details:r})})),n.html(i({content:o.join("\n")})),n.find('link[rel="stylesheet"]').on("load",(t=>{n.find(".variant-preview-text").addClass("is-loaded")})),n.find(".font-refresh-link").on("click",(t=>{let e=$(t.currentTarget);if(t.preventDefault(),!e.hasClass("is-loading")&&confirm("Reloading Adobe Fonts will refresh this page. Proceed?")){e.addClass("is-loading"),n.fadeTo(500,.6);let t=new FormData;t.append("action","typolab_reload_adobe_fonts"),fetch(ajaxurl,{method:"POST",body:t}).then((t=>t.json())).then((t=>{t.success?window.location.reload():(e.removeClass("is-loading"),alert(t.data))}))}}))}}C.prototype.fontProvider="adobe-fonts";class B extends h{getFontFamilyStack(){return this.font_data.font_stack}getAvailableVariants(){return this.font_data.variants.map((t=>l.createFromSystemFontFormat(t,this))).sort(s)}getVariantsPreviewList(){return this.getAvailableVariants().map((t=>({value:t.toString(),title:t.getNicename(),fontFamily:this.getFontFamilyStack(),style:t.style,weight:t.weight,disabled:!0})))}}B.prototype.source="system";class I extends u{ready(){this.fontConstructor=B}selected(){}preview(){let e=this.getFont(),n=this.getContainer(),i=wp.template("font-variants-select-container"),s=wp.template("select-font-variants"),a=[];e.setVariants(e.getAvailableVariants()),a.push(s({previewText:t(),variants:e.getVariantsPreviewList(),selected:e.getVariantsValue(!0)})),n.html(i({content:a.join("\n")})),n.find(".variant-preview-text").addClass("is-loaded")}}I.prototype.fontProvider="system-fonts";const R={"google-fonts":F,"font-squirrel":b,"laborator-fonts":k,"adobe-fonts":C,"system-fonts":I};let L=class t{constructor({fontListSelectContainer:t,fontListSelectOptions:e}){this.$container=$(t),this.fontProvider=e.provider,this.selected=null,this.$tabsList=this.$container.find(".alphabet a"),this.$search=this.$container.find('input[name="search-fonts"]'),this.$filterCategories=this.$container.find('select[name="search-category"]'),this.$fontsList=this.$container.find(".font-list"),this.$value=this.$container.find(".font-list-selector-value"),this.$noResults=$('<div class="no-records">Nothing found!</div>'),this.fontsList=e.items,this.valueProp=e.value_prop,this.data=e.data,this.fontSourceProvider=null,this.lastActiveTab=null,this.init()}init(){this.renderFontsList(),this.setActiveTab(),this.fontSourceProvider=new R[this.fontProvider](this.fontsList,this.$container,this.data),this.$value.val()&&(this.selectValue(this.$value.val()),this.selected instanceof h&&(this.lastActiveTab!==this.firstLetter(this.selected.getFontFamily())&&this.setActiveTab(this.firstLetter(this.selected.getFontFamily())),this.$fontsList.scrollTop()<this.selected.$el.position().top&&this.$fontsList.scrollTop(this.selected.$el.position().top-this.$fontsList.height()/2+this.selected.$el.outerHeight()/2),this.fontSourceProvider.selected(),this.fontSourceProvider.preview())),this.$tabsList.on("click",(t=>{t.preventDefault();let e=$(t.currentTarget).data("tab");this.setActiveTab(e)})),this.$filterCategories.on("change",(()=>{let t=this.$filterCategories.val(),e={category:t};t||(e.tab=this.lastActiveTab),this.filterFontsListDOM(e)})),this.$search.on("keyup",(()=>{let t=this.$search.val(),e={search:t};t||(e.tab=this.lastActiveTab),this.filterFontsListDOM(e)})),this.$fontsList.on("click",".font-selector-item",(t=>{let e=$(t.currentTarget).data("item");t.preventDefault(),this.select(e),this.fontSourceProvider.preview()}))}getFontSourceProvider(){return this.fontSourceProvider}getSelectedFont(){return this.selected}escapeRegExp(t){return t.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}firstLetter(t){return t.toString().substring(0,1).toUpperCase()}filterFontsList(t={search:"",category:"",tab:""}){return this.fontsList.filter((e=>{let n=!0;if(t.tab&&(n=e.font_family.toUpperCase().match(new RegExp(`^${this.firstLetter(t.tab)}`,"i"))),n&&t.category&&(n=e.category===t.category),n&&t.search){let i=[`(^${this.escapeRegExp(t.search)})`,`(\\s${this.escapeRegExp(t.search)})`,`(${this.escapeRegExp(t.search)}(\\s|$))`];n=e.font_family.match(new RegExp(`(${i.join("|")})`,"i"))}return n}))}filterFontsListDOM(t={search:"",category:"",tab:""}){this.fontsList.map(this.setDeactiveFontIterator);var e=this.filterFontsList(t).map(this.setActiveFontIterator).length>0;this.$noResults[e?"removeClass":"addClass"]("active"),this.$fontsList.scrollTop(0)}renderFontsList(){let t=wp.template("font-selector-item");this.$fontsList.html(""),this.fontsList.map((e=>{e.$el=$(t({title:e.title?e.title:e.font_family})),e.$el.data("item",e),this.$fontsList.append(e.$el)})),this.$noResults.appendTo(this.$fontsList)}setDeactiveFontIterator(t){t.$el.removeClass("active")}setActiveFontIterator(t){t.$el.addClass("active")}getDefaultTab(){let t=this.$container.data("active-tab");if(t){let e=this.$tabsList.filter(((e,n)=>t===$(n).data("tab")));if(0<e.length)return e.data("tab")}return this.$tabsList.first().data("tab")}setActiveTab(t=""){t||(t=this.getDefaultTab()),0===this.$tabsList.length&&(t=""),this.filterFontsListDOM({tab:t}),this.$tabsList.removeClass("current").filter(((e,n)=>t===n.dataset.tab)).addClass("current"),this.lastActiveTab=t}select(t){"object"==typeof t&&(this.fontsList.map((e=>e.$el[e===t?"addClass":"removeClass"]("current"))),this.fontSourceProvider.select(t),this.selected=this.fontSourceProvider.getFont(),this.$value.val(this.selected[this.valueProp]),this.fontSourceProvider.change(),this.trigger("font-select",this.getSelectedFont()))}selectValue(t){for(let e of this.fontsList)if(t===e[this.valueProp])return void this.select(e)}};_.extend(L.prototype,Backbone.Events);class E extends h{isValid(){return 0<this.getFontFamily().length&&0<this.getVariants().filter((t=>null!==t.generateFontFace(this.getFontFamily()))).length}}E.prototype.source="hosted";class A{constructor({fontFamilyNameInput:t,fontVariantsContainer:e,fontVariants:n}){this.$fontFamilyNameInput=$(t),this.$fontVariantsContainer=$(e),this.$fontPreviewContainer=$("#font_variants_select_and_preview"),this.font=new E,this.font.setVariants(this.createFontVariants(n)),this.init()}init(){this.setFontFamilyName(this.getFontFamilyNameFromInput()),this.renderVariants(),this.$fontVariantsContainer.sortable({update:()=>{const t=[];this.$fontVariantsContainer.children().each(((e,n)=>{t.push(n.variantReference)})),this.font.setVariants(t),this.preview()}}),this.$fontFamilyNameInput.on("input",(t=>{this.setFontFamilyName(this.getFontFamilyNameFromInput())})),$("#add-font-variant").on("click",(t=>{t.preventDefault(),this.getFontVariants().push(new l),this.renderVariants(),this.preview()}))}getFont(){return this.font}getFontFamilyName(){return this.font.getFontFamily()}setFontFamilyName(t){this.font.setFontFamily(t),this.preview()}getFontVariants(){return this.font.getVariants()}getFontFamilyNameFromInput(){return this.$fontFamilyNameInput.val()}createFontVariants(t){let e=[];return t instanceof Array&&t.forEach((t=>{if(t instanceof l)e.push(t);else{let n=new l({style:t.style,weight:t.weight,unicodeRange:t.unicode_range,display:t.display,font:this.getFont()});_.each(t.src,((t,e)=>n.addFontFile(e,t))),e.push(n)}})),e}openMediaFrame(t,e){let n=wp.media({title:`Select or upload ${t.toUpperCase()}  font file`,multiple:!1,library:{type:["font","application"]}}),i=e[0].selectedAttachment;n.on("open",(()=>{e[0].selectedAttachment&&n.state().get("selection").add(i)})),n.on("select",(()=>{let t=n.state().get("selection").first(),i=t.toJSON();e.val(i.url).trigger("input"),e[0].selectedAttachment=t})),n.open()}bindVariant(t,e){let n={style:e.find(".select-font-style"),weight:e.find(".select-font-weight"),unicodeRange:e.find(".input-font-unicode-range"),display:e.find(".select-font-display"),src:{woff2:e.find('.font-file-woff2 input[type="text"]'),woff:e.find('.font-file-woff input[type="text"]'),ttf:e.find('.font-file-ttf input[type="text"]'),svg:e.find('.font-file-svg input[type="text"]'),eot:e.find('.font-file-eot input[type="text"]')}},i=e=>{t.setStyle(n.style.val()),t.setWeight(n.weight.val()),t.setDisplay(n.display.val()),t.setUnicodeRange(n.unicodeRange.val()),_.each(n.src,((e,n)=>{let i=e.val();t.removeFontFile(n),i&&t.addFontFile(n,i)})),this.preview(),this.trigger("variant-updated",t)};e[0].variantReference=t,n.style.on("change",i),n.weight.on("change",i),n.display.on("change",i),n.unicodeRange.on("input",i),_.each(n.src,((t,e)=>{t.on("input",i),t.next().on("click",(n=>this.openMediaFrame(e,t)))})),e.on("click",".typolab-toggle-body",(n=>{n.preventDefault();let i="typolab-toggle--toggled";e.toggleClass(i),t._isToggled=e.hasClass(i)})),e.on("click",".show-advanced-options",(n=>{n.preventDefault();let i=$(n.currentTarget),s=e.find(".advanced-option"),a="is-visible";s.hasClass(a)?i.text(i.data("show-text")):i.text(i.data("hide-text")),s.toggleClass(a),t._advancedOptionsVisible=s.hasClass(a)})),e.on("click",".delete",(e=>{e.preventDefault(),confirm("Confirm delete?")&&this.removeVariant(t)}))}removeVariant(t){this.font.setVariants(this.font.getVariants().filter((e=>t!==e))),this.renderVariants(),this.preview()}renderVariants(){let t=wp.template("font-variant-form"),e=wp.template("select-options-list");this.$fontVariantsContainer.html("");for(let n of this.getFontVariants()){let i=n.getFontFiles(),s=t({id:n.getInstanceId(),fontStyleOptions:e({optionsList:p,selected:n.style}),fontWeightOptions:e({optionsList:d,selected:n.weight,default:"normal"}),fontDisplayOptions:e({optionsList:f,selected:n.display,default:"swap"}),files:{woff2:i.woff2,woff:i.woff,ttf:i.ttf,svg:i.svg,eot:i.eot},unicodeRange:n.unicodeRange.replace(/U\+/g,""),advancedOptionsVisible:n._advancedOptionsVisible,isToggled:n._isToggled}),a=$(s);this.bindVariant(n,a),this.$fontVariantsContainer.append(a)}}preview(){let e=this.getFontFamilyName(),n=[],i=[];if(this.getFontVariants().forEach((t=>{const s=t.generateFontFace(e);s&&(n.push(s),i.push({title:t.getNicename(),fontFamily:e,style:t.style,weight:t.weight}))})),n.length){let e=wp.template("font-variants-select-container"),s=wp.template("select-font-variants"),a=[];this.$fontPreviewContainer.html(""),a.push(s({style:`<style>${n.join("\n")}</style>`,previewText:t(),variants:i})),this.$fontPreviewContainer.html(e({content:a.join("\n")})).find(".variant-preview-text").addClass("is-loaded")}}}_.extend(A.prototype,Backbone.Events);class N extends h{getStylesheetURL(){return this.stylesheetURL}setStylesheetURL(t){this.stylesheetURL=t}isValid(){return 0<this.getFontFamily().length&&0<this.getVariants().filter((t=>null!==t.generateFontFace(this.getFontFamily()))).length}}N.prototype.source="external",N.prototype.stylesheetURL=null;var T=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;class D{constructor({stylesheetUrlInput:t,fontVariantsContainer:e,fontVariants:n}){this.$stylesheetUrlInput=$(t),this.$fontVariantsContainer=$(e),this.$fontPreviewContainer=$("#font_variants_select_and_preview"),this.font=new N,this.setFontVariants(this.createFontVariants(n)),this.init()}init(){this.setStylesheetURL(this.getStylesheetURLFromInput()),this.$stylesheetUrlInput.on("input",(t=>{this.setStylesheetURL(this.getStylesheetURLFromInput())})),this.renderVariants(),this.getFontVariants().length&&this.preview(),this.$fontVariantsContainer.sortable({update:()=>{const t=[];this.$fontVariantsContainer.children().each(((e,n)=>{t.push(n.variantReference)})),this.setFontVariants(t),this.preview()}}),$("#add-font-variant").on("click",(t=>{t.preventDefault(),this.getFontVariants().push(new l),this.renderVariants()})),$("#fetch-font-variants").on("click",(t=>{t.preventDefault(),(0===this.getFontVariants().length||confirm("Fetching font variants will override existing ones?"))&&this.fetchVariantsFromStylesheet()}))}getFont(){return this.font}getFontVariants(){return this.font.getVariants()}setFontVariants(t){_.each(t,(t=>{t.data.niceName="",t.data.niceName=[t.name,t.getNicename()].join(" - ")})),this.font.setVariants(t)}getStylesheetURL(){return this.font.getStylesheetURL()}setStylesheetURL(t){this.font.setStylesheetURL(t),0===this.getFontVariants().length&&t.match(/^https?.*?(\.css|\\?)/)&&this.fetchVariantsFromStylesheet()}getStylesheetURLFromInput(){return this.$stylesheetUrlInput.val()}createFontVariants(t){let e=[];return t instanceof Array&&t.forEach((t=>{if(t instanceof l)e.push(t);else{let n=new l({name:t.name,style:t.style,weight:t.weight});e.push(n)}})),e}fetchVariantsFromStylesheet(){let t=this.getStylesheetURL(),e=$("#fetch-font-variants"),n=t=>{e[t?"addClass":"removeClass"]("is-loading"),this.$stylesheetUrlInput[t?"addClass":"removeClass"]("is-loading")};if(!t)return alert("Please enter Stylesheet URL!"),void this.$stylesheetUrlInput.focus();n(!0),fetch(t).then((t=>t.text())).then((t=>{let e=a(t),i=[];n(!1),"stylesheet"===e.type&&(_.each(e.stylesheet.rules,(t=>{if("font-face"===t.type){let e,n,s;if(_.each(t.declarations,(t=>{
t.value&&("font-family"===t.property?e=t.value.replace(/['"]/g,""):"font-style"===t.property?n=t.value:"font-weight"===t.property&&(s=t.value))})),e&&n&&s){let t=new l({name:e,style:n,weight:s});i.push(t)}}})),1<i.length&&(i=_.reduce(i,((t,e)=>{let n=t instanceof Array?t:[t];for(let t of n)if(t.equals(e))return n;return n.push(e),n}))),i=i.sort(s),this.setFontVariants(i),this.renderVariants(),this.preview()),i.length||alert("No font variants found in the given stylesheet URL!")})).catch((t=>{n(!1),alert("Error:\n"+t.message)}))}bindVariant(t,e){let n={name:e.find(".input-font-name"),style:e.find(".select-font-style"),weight:e.find(".select-font-weight")},i=e=>{t.setName(n.name.val()),t.setStyle(n.style.val()),t.setWeight(n.weight.val()),t.data.niceName="",t.data.niceName=[t.name,t.getNicename()].join(" - "),this.preview(),this.trigger("variant-updated",t)};e[0].variantReference=t,n.name.on("input",i),n.style.on("change",i),n.weight.on("change",i),e.on("click",".typolab-toggle-body",(n=>{n.preventDefault();let i="typolab-toggle--toggled";e.toggleClass(i),t._isToggled=e.hasClass(i)})),e.on("click",".delete",(e=>{e.preventDefault(),this.removeVariant(t)}))}removeVariant(t){this.setFontVariants(this.font.getVariants().filter((e=>t!==e))),this.renderVariants(),this.preview()}renderVariants(){let t=wp.template("custom-font-variant-form"),e=wp.template("select-options-list");this.$fontVariantsContainer.html("");for(let n of this.getFontVariants()){let i=t({id:n.getInstanceId(),fontFamily:n.name,fontStyleOptions:e({optionsList:p,selected:n.style}),fontWeightOptions:e({optionsList:d,selected:n.weight,default:"normal"}),isToggled:n._isToggled}),s=$(i);this.bindVariant(n,s),this.$fontVariantsContainer.append(s)}}preview(){let e=[],n=[];if(this.getFontVariants().forEach((t=>{const i=t.generateFontFace();i&&(e.push(i),n.push({title:t.getNicename(),fontFamily:t.name,style:t.style,weight:t.weight}))})),this.$fontPreviewContainer.html(""),e.length){let i=wp.template("font-variants-select-container"),s=wp.template("select-font-variants"),a=[];a.push(s({stylesheet:this.getStylesheetURL(),style:`<style>${e.join("\n")}</style>`,previewText:t(),variants:n,selected:this.getFont().getVariantsValue(!0)})),this.$fontPreviewContainer.html(i({content:a.join("\n")})).find(".variant-preview-text").addClass("is-loaded")}}}_.extend(D.prototype,Backbone.Events);class U{constructor({type:t,operator:e,value:n}={}){this.type=t||null,this.operator=e||"equals",this.value=n||null}}class z{constructor({conditionalStatementsContainer:t,conditionalStatements:e}){this.$container=$(t),this.$placeholder=this.$container.find(".no-statements").clone(),this.options=e.options,this.statements=[],e.statements.forEach((t=>this.addStatementEntry(t))),this.init()}init(){$("#add-new-conditional-statement").on("click",(t=>{t.preventDefault(),this.addStatementEntry()}))}getStatements(){return this.statements}removeStatement(t){this.statements=this.statements.filter((e=>e!==t)),0===this.statements.length&&this.$placeholder.appendTo(this.$container.find("tbody"))}bindStatement(t,e,n){let i={type:e.find(".select-statement-type"),operator:e.find(".select-statement-operator"),value:e.find(".select-statement-value")},s=wp.template("select-options-list"),a=t=>{let e=[];t||(t=i.type.val()),_.each(this.options,(n=>{n.forEach((n=>{t===n.name&&_.each(n.values,((t,n)=>e.push({title:t,value:n})))}))})),i.value.html(s({optionsList:e}))},o=e=>{!0===e&&a(),t.type=i.type.val(),t.operator=i.operator.val(),t.value=i.value.val()};_.each(this.options,((t,e)=>{let n=t.map((t=>({value:t.name,title:t.title})));i.type.append(`<optgroup label="${e}">${s({optionsList:n})}</optgroup>`)})),o(!0),n&&(a(n.type),i.type.find("option").filter(((t,e)=>e.value===n.type)).prop("selected",!0),i.operator.find("option").filter(((t,e)=>e.value===n.operator)).prop("selected",!0),i.value.find("option").filter(((t,e)=>e.value===n.value)).prop("selected",!0),o()),i.type.on("change",(t=>o(!0))),i.operator.on("change",(t=>o())),i.value.on("change",(t=>o())),e.on("click",".remove-conditional-statement",(n=>{n.preventDefault(),this.removeStatement(t),e.remove()}))}addStatementEntry(t=null){let e=new U,n=wp.template("conditional-statement-entry"),i=wp.template("select-options-list"),s=this.$container.find("tbody"),a=$(n({id:"statement-"+z.instanceId++,operatorOptions:i({optionsList:[{value:"equals",title:"is"},{value:"not-equals",title:"is not"}]})}));this.bindStatement(e,a,t),this.getStatements().push(e),s.find(".no-statements").remove(),s.append(a)}}z.instanceId=1;class P{constructor({type:t,id:e,variant:n,include:i}){this.type=t,this.id=e,this.variant=n,this.include=i}getId(){return this.id}isBaseSelector(){return"base-selector"===this.type}doInclude(){return this.include}}class O{constructor({fontBaseSelectorsContainer:t,fontBaseSelectors:e,font:n}){this.$fontBaseSelectorsContainer=$(t),this.baseSelectors=e.selectors,this.selectedValues=e.values.map((t=>new P({type:t.type,id:t.id,variant:t.variant,include:t.include}))),this.font=n,this.init()}init(){_.each(this.baseSelectors,((t,e)=>{t.$baseSelector=$(`.font-base-selector[data-id="${e}"]`),t.$checkbox=t.$baseSelector.find('input[type="checkbox"]'),t.$selectElement=t.$baseSelector.find(".select-font-variant")})),this.selectedValues.forEach((t=>{let e=this.baseSelectors[t.getId()];e&&(t.doInclude()&&(e.$checkbox.prop("checked",!0),e.$baseSelector.addClass("checked")),e.selectedValue=t.variant)}));let t=this.getFont();t&&!t.hasOwnProperty("fetched")&&this.resetVariants(),_.each(this.getBaseSelectors(),(t=>{t.$baseSelector.on("click",(e=>{e.target===t.$baseSelector[0]&&t.$checkbox.click()})),t.$selectElement.on("change",(e=>{this.setCurrentSelectedVariantValue(t),t.$checkbox.prop("checked",!0).trigger("change")})),t.$checkbox.on("change",(e=>{t.$baseSelector[t.$checkbox.is(":checked")?"addClass":"removeClass"]("checked")}))}))}getBaseSelectors(){return this.baseSelectors}getFont(){return this.font}setFont(t){this.font=t}getCurrentSelectedVariantValue(t,e){return _.contains(e,t.selectedValue)?t.selectedValue:null}setCurrentSelectedVariantValue(t){t.selectedValue=t.$selectElement.val()}resetVariants(){let t=this.getFont(),e=t.getVariants(),n=e.map((e=>e.toString(t))),i=t.getDefaultVariant(),s=wp.template("select-options-list");_.each(this.getBaseSelectors(),(a=>{let o=this.getCurrentSelectedVariantValue(a,n),r=e.map((e=>({value:e.toString(t),title:e.getNicename()})));!o&&i&&(a.selectedValue=o=i.toString(t)),a.$selectElement.html(s({optionsList:r,selected:o}))}))}}const G={};let j=class t extends Backbone.View{preinitialize(){this.template=wp.template("button-group-button")}initialize(t){this.model.on("change:checked",(t=>{const e="button-primary",n="button-alt";this.$el.removeClass([e,n].join(" ")).addClass(t.isChecked()?e:n)})),this.render()}render(){this.setElement(this.template(this.model.attributes))}};_.extend(G,{Button_Group_Button:j});let M=class t extends Backbone.View{preinitialize(){this.tagName="div",this.className="button-group"}initialize(t){t=_.defaults(t,{collection:null,classes:[],allowNone:!1,type:"checkbox",input:null}),this.collection=t.collection,this.allowNone=t.allowNone,this.isRadio="radio"===t.type,this.input=t.input,this.optionViews=[],t.classes.length&&this.$el.addClass(t.classes.join(" ")),this.render(),this.setupEvents()}render(){return this.$el.empty(),this.collection.forEach((t=>{let e=new G.Button_Group_Button({model:t});t.get("tooltip")&&e.$el.tooltipster({theme:"tooltipster-borderless",content:t.get("tooltip")}),this.$el.append(e.el),this.optionViews.push(e)})),this.input&&(this.$input=$("<input>",{type:"hidden",name:this.input,value:this.getValue()}),this.$input.prependTo(this.$el)),this}setupEvents(){this.optionViews.forEach((t=>{t.$el.on("click",(e=>{e.preventDefault(),this.setValue(t.model.id)}))}))}getValue(){let t=[];return this.optionViews.forEach((e=>{e.model.isChecked()&&t.push(e.model.id)})),this.isRadio?t[0]?t[0]:null:t}setValue(t,e=!1){let n=this.getValue();this.optionViews.forEach((e=>{if(t===e.model.id||_.contains(t,e.model.id)){let t=!0;this.allowNone&&(t=!e.model.isChecked()),this.isRadio&&this.optionViews.forEach((t=>{t.model.id!==e.model.id&&t.model.set("checked",!1)})),e.model.set("checked",t)}}));let i=this.getValue();!1===_.isEqual(n,i)&&(this.input&&this.$input.val(i),e||this.trigger("change",i))}};_.extend(G,{Button_Group:M});class q extends Backbone.View{preinitialize(){this.template=wp.template("size-unit-input")}initialize(t){t=_.defaults(t,{input:null,units:{},defaultUnit:null,value:null,min:null,max:null,step:"any"}),this.model=new Backbone.Model({value:null,unit:null}),this.input=t.input,this.units=t.units,this.defaultUnit=t.defaultUnit,this.value=t.value,this.min=t.min,this.max=t.max,this.step=t.step,this.model.set("unit",this.defaultUnit),this.render()}getValue(t){let e=this.model.toJSON();return t?[e.value,e.unit].join(""):e}setValue(t,e=!1){let n,i;if("string"==typeof t)for(let e in this.units){let s=t.match(new RegExp(`^(?<value>[0-9.]*)(?<unit>${e})$`));if(s){n=s.groups.value,i=s.groups.unit;break}}else t&&"object"==typeof t&&t.hasOwnProperty("value")&&t.hasOwnProperty("unit")&&(n=t.value,i=t.unit);this.$value.val(n),this.$unitSelect.val(i),this.renderUnitText(),this.updateModelValue(e)}render(){let t=$(this.template({value:this.value,units:this.units,min:this.min,max:this.max,step:this.step}));this.$value=t.find(".value-input"),this.$unitText=t.find(".unit-text"),this.$unitSelect=t.find(".units-select"),this.$unitSelect.val(this.model.get("unit")),this.input&&(this.$input=$("<input>",{type:"hidden",name:this.input,value:this.getValue(!0)}),this.$input.prependTo(t)),this.renderUnitText(),this.setElement(t),this.$value.on("input",(()=>this.updateModelValue())),this.$unitSelect.on("change",(()=>this.updateModelValue())),this.$unitSelect.on("change",(()=>this.renderUnitText()))}updateModelValue(t=!1){this.model.set({value:this.$value.val(),unit:this.$unitSelect.val()||this.$unitSelect.find("option:first-child").val()}),this.input&&this.$input.val(this.getValue(!0)),t||this.trigger("change",this.getValue())}renderUnitText(){this.$unitText.html(this.$unitSelect.find("option:selected").html())}}_.extend(G,{Size_Unit_Input:q});class J extends Backbone.View{preinitialize(){this.className="responsive-input"}initialize(t){this.model=new Backbone.Model({}),this.responsiveBreakpoints=t.responsiveBreakpoints,this.value=t.value,this.renderInput=t.renderInput,this.responsiveBreakpoints.forEach((t=>{let e=this.value?this.value[t.id]:null;this.model.set(t.id,e)})),this.render(),this.showCurrentBreakpointEntry(),this.responsiveBreakpoints.bind("change",(()=>this.showCurrentBreakpointEntry())),this.model.on("change",(()=>{this.trigger("change",this.getValue())}))}showCurrentBreakpointEntry(){this.responsiveBreakpointElements.forEach((t=>{t.responsiveBreakpoint.isSelected()?t.$el.addClass("current"):t.$el.removeClass("current")}))}getValue(){let t={};return this.responsiveBreakpoints.forEach((e=>{let n=e.id,i=this.getResponsiveValue(n),s=this.getInheritValue(e);t[n]=i||s})),t}updateValue(){_.each(this.getValue(),((t,e)=>{this.value[e]=t}))}getResponsiveValue(t){return this.model.get(t)}setResponsiveValue(t,e){this.model.set(t,e),this.responsiveBreakpointElements.forEach((t=>{let e=t.responsiveBreakpoint;if(!this.getResponsiveValue(e.id)){let n=this.getInheritValue(e);t.inputView.trigger("inherit-value",n),this.updateValue()}}))}getInheritValue(t){let e=t?t.get("inherit"):null;if(e){let t=this.getResponsiveValue(e);return t||this.getInheritValue(this.responsiveBreakpoints.findWhere({id:e}))}return null}render(){this.responsiveBreakpointElements=[],this.responsiveBreakpoints.forEach((t=>{let e=$("<div>",{class:["responsive-input-entry",`responsive-input-entry-${t.id}`].join(" ")}),n=t.id,i=()=>this.getValue()[n],s=t=>this.setResponsiveValue(n,t),a=this.renderInput(t,i,s);e.append(a.el),this.responsiveBreakpointElements.push({$el:e,inputView:a,responsiveBreakpoint:t}),e.appendTo(this.$el)}))}}_.extend(G,{Responsive_Input:J});const H={};class K extends Backbone.Model{defaults(){return{id:"",name:"",icon:"",min_size:"",max_size:"",default:"",inherit:"",selected:!1}}initialize(t){t.default&&this.set("selected",!0)}isSelected(){return this.get("selected")}prepareForButtonGroup(){return{id:this.id,tooltip:this.get("name"),icon:this.get("icon"),checked:this.get("default")}}}_.extend(H,{Responsive_Breakpoint:K});class W extends Backbone.Collection{initialize(){this.model=K}}_.extend(H,{Responsive_Breakpoints:W});let Q=class t extends Backbone.Model{defaults(){return{selectors:"",fontVariant:"",textTransform:{},fontSize:{},lineHeight:{},letterSpacing:{}}}initialize(t){H.Custom_Selector.hasOwnProperty("instanceIterator")||(H.Custom_Selector.instanceIterator=0),H.Custom_Selector.instanceIterator++,this.set("id",`custom-selector-${H.Custom_Selector.instanceIterator}`)}};_.extend(H,{Custom_Selector:Q});let Z=class t extends Backbone.Collection{initialize(t){this.model=Q}};_.extend(H,{Custom_Selectors:Z});class X extends Backbone.Model{defaults(){return{id:null,text:"",tooltip:"",icon:"",active:!1}}isChecked(){return this.has("checked")&&this.get("checked")}}_.extend(H,{Button_Group_Button:X});class Y extends Backbone.Collection{preinitialize(t,e){this.model=X}}_.extend(H,{Button_Group:Y});let tt=class t extends Backbone.Model{defaults(){return{id:"",groupId:"",title:"",value:null}}getValue(t="",e=null){let n=this.get("value");return n&&(n=t?n.get(t):n.attributes),n||(n=e),n}};_.extend(H,{Font_Appearance_Element:tt});class et extends Backbone.Collection{initialize(t){this.model=tt}modelId(t){return t.group_id+"_"+t.id}}_.extend(H,{Font_Appearance_Elements:et});let nt=class t extends Backbone.Model{defaults(){return{id:"",name:"",elements:{}}}preinitialize(t){let e=t.id;t.elements=new H.Font_Appearance_Elements(_.map(t.elements,((t,n)=>({id:n,groupId:e,...t}))))}getElements(){return this.get("elements")}};_.extend(H,{Font_Appearance_Group:nt});class it extends Backbone.Collection{preinitialize(){this.model=nt}}_.extend(H,{Font_Appearance_Groups:it});class st extends Backbone.Model{defaults(){return{id:"",groupId:"",fontSize:{},lineHeight:{},letterSpacing:{},textTransform:{}}}}_.extend(H,{Font_Appearance_Element_Value:st});class at extends Backbone.Collection{preinitialize(){this.model=st}}_.extend(H,{Font_Appearance_Element_Values:at});class ot extends Backbone.View{preinitialize(){this.template=wp.template("custom-selector"),this.events={"click .remove-custom-selector":"remove"}}initialize(t){t=_.defaults(t,{customSelectorsInstance:null}),this.customSelectorsInstance=t.customSelectorsInstance,this.render()}getResponsiveBreakpoints(){return this.customSelectorsInstance.responsiveBreakpoints}getPredefinedSelectors(){return this.customSelectorsInstance.predefinedSelectors}filterOtherSelectors(t){let e=[],n=_.pluck(this.getPredefinedSelectors(),"value");return _.each(t,(t=>{_.contains(n,t)||e.push({value:t,name:t})})),e}getCurrentFont(){return this.customSelectorsInstance.currentFont}getFontVariantsOptions(){if(!this.getCurrentFont())return null;let t,e={value:"",title:"- Inherit -"},n=this.getCurrentFont().getVariants().map((t=>({value:t.toString(),title:t.getNicename()}))),i,s;return wp.template("select-options-list")({optionsList:[e,...n],selected:this.model.get("fontVariant")})}remove(t){t.preventDefault(),this.customSelectorsInstance.collection.remove(this.model)}render(){let t=$(this.template(this.model.toJSON())),e=this.model,n=e.id,i=e.get("selectors"),s=e.get("fontVariant"),a=e.get("textTransform"),o=e.get("fontSize"),r=e.get("lineHeight"),l=e.get("letterSpacing"),c=(t,e)=>`font_custom_selectors[${n}][${t}]`+(e?`[${e}]`:""),h=$(wp.template("custom-selectors-input")({inputName:c("selectors")+"[]",predefinedSelectors:[...this.getPredefinedSelectors(),...this.filterOtherSelectors(i)]}));i&&h.val(i),t.find(".column-selectors").append(h);let u=$("<select>",{name:c("variant"),class:"font-variant-select"});u.html(this.getFontVariantsOptions()),t.find(".column-font-variant").append(u);let p=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:a,renderInput:(t,e,n)=>{let i=new G.Button_Group({allowNone:!0,type:"radio",collection:new H.Button_Group([new H.Button_Group_Button({id:"uppercase",text:"TT",tooltip:"Uppercase"}),new H.Button_Group_Button({id:"capitalize",text:"Tt",tooltip:"Capitalize"}),new H.Button_Group_Button({id:"lowercase",text:"tt",tooltip:"Lowercase"})]),input:c("text_transform",t.id)});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(t=>n(t))),i}});t.find(".column-font-case").append(p.el);let d=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:o,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:c("font_size",t.id),units:g,defaultUnit:y,min:0});const s=e();return null!==s&&i.setValue(s),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-font-size").append(d.el);let f=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:r,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:c("line_height",t.id),units:m,defaultUnit:y,min:0});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-line-height").append(f.el);let w=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:l,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:c("letter_spacing",t.id),units:v,defaultUnit:y,min:0});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-letter-spacing").append(w.el),this.setElement(t),h.select2({tags:!0,placeholder:"Choose from predefined or add your own CSS selectors"}),h.on("change",(t=>{h.children().each(((t,e)=>{let n=e.value.split(",");1<n.length&&(n.forEach((t=>{t=t.trim();let e=new Option(t,t,!0,!0);h.append(e)})),e.remove())}))})),this.customSelectorsInstance.on("variants-updated",(()=>{u.html(this.getFontVariantsOptions(s))})),h.on("change",(t=>{e.set("selectors",h.val())})),u.on("change",(t=>{e.set("fontVariant",u.val())})),p.on("change",(t=>{e.set("textTransform",t)})),d.on("change",(t=>{e.set("fontSize",t)})),f.on("change",(t=>{e.set("lineHeight",t)})),w.on("change",(t=>{e.set("letterSpacing",t)}))}}_.extend(G,{Custom_Selector:ot});class rt extends Backbone.View{preinitialize(){this.el=$(".font-custom-selectors"),this.events={"click #add-new-selector":"addNewSelector"},this.customSelectorViews=[]}initialize(t){t=_.defaults(t,{responsiveBreakpoints:null,predefinedSelectors:null,collection:null,currentFont:null}),this.collection=t.collection,this.responsiveBreakpoints=t.responsiveBreakpoints,this.predefinedSelectors=t.predefinedSelectors,this.currentFont=t.currentFont,this.$tbody=this.$el.find("tbody"),this.render(),this.collection.comparator="index",this.$tbody.sortable({axis:"y",handle:".column-sort a",update:t=>{this.$tbody.children().each(((t,e)=>{this.collection.at(e.index).set("index",t)})),this.collection.sort()}}),this.collection.bind("add",(()=>this.render())),this.collection.bind("remove",(()=>this.render())),this.collection.bind("reset",(()=>this.render()))}getCurrentResponsiveBreakpont(){for(let t of this.responsiveBreakpoints)if(t.isSelected())return t;return this.responsiveBreakpoints.at(0)}addNewSelector(t){t.preventDefault(),this.collection.add(new H.Custom_Selector({})),this.resetIndexes()}resetIndexes(){this.collection.forEach(((t,e)=>{t.set("index",e)}))}render(){if(this.customSelectorViews=[],this.$tbody.empty(),this.collection.forEach(((t,e)=>{const n=new G.Custom_Selector({model:t,customSelectorsInstance:this});n.el.index=e,this.$tbody.append(n.el),this.customSelectorViews.push(n)})),this.resetIndexes(),0===this.collection.length){const t=wp.template("custom-selector-empty");this.$tbody.append(t())}}}_.extend(G,{Custom_Selectors:rt});class lt extends Backbone.View{initialize(t){t=_.defaults(t,{responsiveBreakpoints:null}),this.responsiveBreakpoints=t.responsiveBreakpoints,this.render()}getGroupId(){return this.model.id}render(){this.setElement($(`.font-appearance-group[data-group-id="${this.getGroupId()}"]`)),this.$tbody=this.$el.find(".typolab-table tbody"),this.$tbody.empty(),this.model.getElements().forEach((t=>{let e=new G.Font_Appearance_Element({model:t,fontAppearanceGroupInstance:this});this.$tbody.append(e.el)}))}}_.extend(G,{Font_Appearance_Group:lt});class ct extends Backbone.View{preinitialize(){this.template=wp.template("font-appearance-element")}initialize(t){t=_.defaults(t,{fontAppearanceGroupInstance:null}),this.fontAppearanceGroupInstance=t.fontAppearanceGroupInstance,this.render()}getGroupId(){return this.fontAppearanceGroupInstance.getGroupId()}getResponsiveBreakpoints(){return this.fontAppearanceGroupInstance.responsiveBreakpoints}render(){let t=$(this.template(this.model.toJSON())),e=this.model,n=e.id,i=e.getValue("fontSize",{}),s=e.getValue("lineHeight",{}),a=e.getValue("letterSpacing",{}),o=e.getValue("textTransform",{}),r=(t,e)=>`font_appearance_groups[${this.getGroupId()}][${n}][${t}]`+(e?`[${e}]`:""),l=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:i,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:r("font_size",t.id),units:g,defaultUnit:y,min:0});const s=e();return null!==s&&i.setValue(s),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-font-size").append(l.el);let c=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:s,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:r("line_height",t.id),units:m,defaultUnit:y,min:0});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-line-height").append(c.el);let h=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:a,renderInput:(t,e,n)=>{let i=new G.Size_Unit_Input({input:r("letter_spacing",t.id),units:v,defaultUnit:y,min:0});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(()=>{n(i.getValue(!0))})),i}});t.find(".column-letter-spacing").append(h.el);let u=new G.Responsive_Input({responsiveBreakpoints:this.getResponsiveBreakpoints(),value:o,renderInput:(t,e,n)=>{let i=new G.Button_Group({allowNone:!0,type:"radio",collection:new H.Button_Group([new H.Button_Group_Button({id:"uppercase",text:"TT",tooltip:"Uppercase"}),new H.Button_Group_Button({id:"capitalize",text:"Tt",tooltip:"Capitalize"}),new H.Button_Group_Button({id:"lowercase",text:"tt",tooltip:"Lowercase"})]),input:r("text_transform",t.id)});return i.setValue(e()),i.on("inherit-value",(t=>{i.setValue(t,!0)})),i.on("change",(t=>n(t))),i}});t.find(".column-font-case").append(u.el),this.setElement(t),this.$el.on("click",".column-element label",(e=>{t.find(".column-font-size .value-input").focus()}))}}_.extend(G,{Font_Appearance_Element:ct});class ht{constructor({customSelectorsContainer:t,customSelectors:e,font:n}){this.$customSelectorsContainer=$(t),this.responsiveBreakpoints=new H.Responsive_Breakpoints(_.map(e.responsive,((t,e)=>({id:e,...t})))),this.customSelectors=new H.Custom_Selectors(_.map(e.values,(t=>({selectors:t.selectors,fontVariant:t.variant,textTransform:t.text_transform,fontSize:t.font_size,lineHeight:t.line_height,letterSpacing:t.letter_spacing})))),this.predefinedSelectors=_.map(e.predefined_selectors,((t,e)=>({...t,value:`:${e}:`}))),this.font=n,this.init()}init(){let t=new H.Button_Group(this.responsiveBreakpoints.map((t=>t.prepareForButtonGroup())));this.responsiveBreakpointsButtons=new G.Button_Group({collection:t,classes:["responsive-devices"],type:"radio"}),this.responsiveBreakpointsButtons.on("change",(t=>this.responsiveBreakpoints.forEach((e=>{let n=t===e.id,i=`font-custom-selectors--${e.id}`;this.$customSelectorsContainer[n?"addClass":"removeClass"](i),e.set("selected",n)})))),this.$customSelectorsContainer.prepend(this.responsiveBreakpointsButtons.el),this.customSelectorsTable=new G.Custom_Selectors({responsiveBreakpoints:this.responsiveBreakpoints,predefinedSelectors:this.predefinedSelectors,collection:this.customSelectors,currentFont:this.font})}getFont(){return this.font}setFont(t){this.font=t}resetVariants(){this.customSelectorsTable.currentFont=this.getFont(),this.customSelectorsTable.trigger("variants-updated")}}class ut{constructor(){this.selectedFont,this.init(),ut.trigger("ready",this)}init(){let t=document.querySelector(".fonts-list-select"),e=this.parseJSON("font_selector_fonts_list");if(t){let n=new L({fontListSelectContainer:t,fontListSelectOptions:e});n.on("font-select",(t=>this.setSelectedFont(t))),this.setSelectedFont(n.getSelectedFont())}let n=document.querySelector(".font-face-variants"),i=this.parseJSON("font_face_variants"),s=document.querySelector("#font_family");if(s&&n){i.length||i.push(new l);let t=new A({fontFamilyNameInput:s,fontVariantsContainer:n,fontVariants:i});t.on("variant-updated",(t=>this.variantsUpdated())),this.setSelectedFont(t.getFont())}let a=document.querySelector("#stylesheet_url");if(a&&n){let t=new D({stylesheetUrlInput:a,fontVariantsContainer:n,fontVariants:i});t.on("variant-updated",(t=>this.variantsUpdated())),this.setSelectedFont(t.getFont())}let o=document.querySelector(".font-base-selectors"),r=this.parseJSON("font_base_selectors");if(o&&r){let t=new O({fontBaseSelectorsContainer:o,fontBaseSelectors:r,font:this.getSelectedFont()});ut.on("font-variants-updated",(e=>{t.setFont(this.getSelectedFont()),t.resetVariants()}))}let c=document.querySelector(".font-custom-selectors"),h=this.parseJSON("font_custom_selectors");if(c&&h){let t=new ht({customSelectorsContainer:c,customSelectors:h,font:this.getSelectedFont()});ut.on("font-variants-updated",(e=>{t.setFont(this.getSelectedFont()),t.resetVariants()}))}let u=document.querySelector(".font-conditional-loading"),p=this.parseJSON("conditional_statements");u&&p&&new z({conditionalStatementsContainer:u,conditionalStatements:p})}getSelectedFont(){return this.selectedFont}setSelectedFont(t){t&&(this.selectedFont=t,this.selectedFont.off("variants-updated"),this.selectedFont.on("variants-updated",(()=>this.variantsUpdated())))}variantsUpdated(){let t=this.getSelectedFont();t&&ut.trigger("font-variants-updated",t.getVariants())}parseJSON(t,e=null){return ut.parseJSON(t,e)}}_.extend(ut,Backbone.Events),ut.parseJSON=function(t,e=null){let n=document.querySelector(`#${t}`);if(n){let t=JSON.parse(n.innerHTML);if(t)return t}return e},ut.on("ready",(function(){$(".typolab .tooltip").each(((t,e)=>{$(e).tooltipster({position:"right",theme:"tooltipster-borderless"})}));let t=$('.typolab .button-primary[type="submit"]');if(t.each(((e,n)=>{$(n).closest("form").on("submit",(e=>{t.addClass("is-loading")}))})),$(".typolab .components-form-toggle").each(((t,e)=>{let n=$(e),i=n.find("input");i.on("change",(t=>{n[i.is(":checked")?"addClass":"removeClass"]("is-checked")}))})),$(".change-source").length){let t=$(".change-source"),e=$(".typolab-dropdown.font-source-select"),n=()=>{let n=t.position();n.top+=t.outerHeight()+10,e.css(n)};n(),t.on("click",(i=>{i.preventDefault(),n(),e.add(t).toggleClass("visible")})),$(document).on("mouseup",(n=>{e.hasClass("visible")&&(t.is(n.target)||e.is(n.target)||e.has(n.target).length||e.add(t).removeClass("visible"))})),e.on("click","a",(n=>{confirm("Confirm font source change?")?e.add(t).removeClass("visible"):n.preventDefault()}))}})),ut.on("ready",(function(){let t=$(".typolab-select-font-source");if(t.length){let e=t.find("tbody tr"),n=function(t){$(".font-source-description").removeClass("selected").filter(".font-source-description-"+t).addClass("selected")};e.on("click",(function(){let t=$(this).find('input[type="radio"]'),i=t.val();e.removeClass("hover"),t.prop("checked",!0),$(this).addClass("hover"),n(i)}));let i=e.find("input:checked");i.closest("tr").addClass("hover"),n(i.val())}})),ut.on("ready",(function(){let t=$(".typolab-fonts-list"),e=t.find("table.fonts");t.length&&(e.on("click",".delete a",(t=>{confirm("Are you sure you want to delete this font?")||t.preventDefault()})),e.on("click",".flush a",(t=>{confirm("Confirm font reinstall?\nThis will download font files again and create new stylesheet file.")||t.preventDefault()})),t.on("submit",(e=>{let n=t.find(".check-column input:checked").map(((t,e)=>e.value));0<n.length&&"delete"===t.find('select[name="action"]').val()&&!confirm("Are you sure you want to delete selected fonts?")&&e.preventDefault(),0<n.length&&"flush"===t.find('select[name="action"]').val()&&!confirm("Confirm fonts reinstall?\nThis will download font files again and create new stylesheet file for each font.")&&e.preventDefault()})))})),ut.on("ready",(function(){let t=$("#edit-font-form");if(t.length){let e=t.find("#typolab-toggle-advanced-options"),n=t.find("#typolab-advanced-options");e.on("click",(t=>{t.preventDefault(),n.add(e).toggleClass("visible")}));let i=t.find("#font_status"),s=()=>{let t=i.closest(".grouped-input");t.removeClass("red green"),"active"===i.val()?t.addClass("green"):t.addClass("red")};s(),i.on("change",s)}}));class pt{constructor({fontAppearance:t}){this.fontAppearanceGroups=new H.Font_Appearance_Groups(t.groups),this.responsiveBreakpoints=new H.Responsive_Breakpoints(_.map(t.responsive,((t,e)=>({id:e,...t})))),this.values=new H.Font_Appearance_Element_Values(_.map(t.values,(t=>({id:t.id,groupId:t.group_id,fontSize:t.font_size,lineHeight:t.line_height,letterSpacing:t.letter_spacing,textTransform:t.text_transform})))),this.init()}getResponsiveBreakpoints(){return new H.Responsive_Breakpoints(this.responsiveBreakpoints.toJSON())}init(){this.assignElementValues(),this.fontAppearanceGroups.forEach((t=>{let e=this.getResponsiveBreakpoints(),n=new H.Button_Group(e.map((t=>t.prepareForButtonGroup()))),i=new G.Button_Group({collection:n,classes:["responsive-devices"],type:"radio"}),s=new G.Font_Appearance_Group({responsiveBreakpoints:e,model:t});i.on("change",(t=>e.forEach((e=>{let n=t===e.id,i=`font-appearance-group--${e.id}`;s.$el[n?"addClass":"removeClass"](i),e.set("selected",n)})))),s.$el.find("tr.heading th").append(i.el)}))}assignElementValues(){this.fontAppearanceGroups.forEach((t=>{let e;t.getElements().forEach((t=>this.assignElementValue(t)))}))}assignElementValue(t){let e=this.values.where({id:t.get("id"),groupId:t.get("groupId")});1===e.length&&t.set("value",e[0])}}ut.on("ready",(function(){let t=ut.parseJSON("font_appearance");t&&new pt({fontAppearance:t})})),ut.on("ready",(function(){let t=$(".typolab #typolab-settings-form");if(t.length){t.find("i.info[title]").on("click",(t=>t.preventDefault())).tooltipster({position:"right",theme:"tooltipster-borderless"});let e=$(".font-export-import"),n=e.find(".font-export-import--export"),i=e.find(".font-export-import--import"),s=()=>{let t={};return n.find('[name="font_export"]').each(((e,n)=>{t[n.value]=n.checked?1:0})),t};n.on("click",".button",(t=>{t.preventDefault();let e=$(t.currentTarget),i=n.find("tbody"),a=n.find(".font-export-checkboxes"),o=n.find(".font-export-loading"),r=n.find(".font-export-data"),l=r.find("#font_export_data");e.addClass("disabled"),i.css("height",i.height()),a.hide(),o.fadeTo(300,1),$.post(ajaxurl,{action:"typolab_export",exports:s()}).done((t=>{t.success?(l.val(t.data),i.css("height",""),o.hide(),r.fadeTo(300,1,(()=>l.select()))):alert("An error occurred while exporting fonts!")}))})),i.on("click",".button",(t=>{t.preventDefault();let e=$(t.currentTarget),n=i.find("tbody"),s=i.find(".font-import-data"),a=i.find("#font_import"),o=i.find(".font-import-loading"),r=o.find(".progress"),l=i.find(".font-import-finished"),c=0,h=0;const u=(t,e,n,i,s="",a="")=>{let o=null;const r=l=>{o||(o=l);const c=Math.min((l-o)/i,1);t.innerHTML=s+Math.floor(c*(n-e)+e)+a,c<1&&window.requestAnimationFrame(r)};window.requestAnimationFrame(r)},p=(t,e)=>{
let n=e.hasOwnProperty(t);return("install_fonts"===t&&e.fonts||"preload_fonts"===t&&e.fonts)&&(n=!0),n&&c++,function(){return new Promise(((i,s)=>{n?$.post(ajaxurl,{action:"typolab_import",type:t,data:e[t]}).done(i).fail(s).always((()=>{let t=h/c*100,e=++h/c*100;u(r[0],t,e,200,"(","%)")})):i()}))}},d=t=>new Promise(((e,n)=>{let i=p("font_settings",t),s=p("font_appearance",t),a=p("fonts",t),o=p("install_fonts",t),r=p("preload_fonts",t);i().then(s).then(a).then(o).then(r).then(e)}));try{const t=JSON.parse(a.val());e.addClass("disabled"),n.css("height",n.height()),s.hide(),o.fadeTo(300,1),d(t).then((()=>setTimeout((()=>{n.css("height",""),o.hide(),l.fadeTo(300,1)}),1e3)))}catch(t){alert("Please enter valid JSON data")}}))}})),$(document).ready((function(){window.typolab=new ut}))}();